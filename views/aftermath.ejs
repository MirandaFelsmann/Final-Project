<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aftermath</title>
    <link rel="stylesheet" href="/aftermathstyles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@100..900&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div id="headerLinks">
          
          <form action="/about" method="GET">
              <button style="color: grey; border: none; font-family: Lemon Milk; font-size: 1rem; background-color: transparent">about</button>
          </form>
          <p style="font-size: 25px; font-weight: 700; margin-top:22px; color: #b30000; height: 100%; margin-left: 19px"><a  onclick="homefunc()"><img src="/images/logo.svg" style="height: 100%"></a></p>
          <form action="/profile" method="GET">
              <button style="color: grey; border: none; font-family: Lemon Milk; font-size: 1rem; background-color: transparent">profiles</button>
          </form>
    </div>
    <div id="topSpaceFill"></div>
    <div id="content">
        <form action="/new-round" method="POST">
            <h3 style="font-size: 1.3rem; font-style: italic; text-align: center; margin-top: 0">Victory for <input id="victor" name="victor" value="<%=winningNation.name%>" style="display: none"><%=winningNation.name%>!</h3>
            <div id="winPtsDecl">You have earned <%=armyEarned%> army points and <%=navyEarned%> navy points. How do you want to distribute them?</div>
            
            <div id="pointsRemDist">
                <div id="leftCirc">
                    <div id="innerCirc">
                        <div id="circContent">
                            <h4 style="font-weight:700; margin-top: 0; font-size: 1.2rem">Points Left</h4>
                            <div id="pointsEarned">
                                <p style="width: 30%"><input type="text" id="armyLeft" name="armyLeft" placeholder="<%=armyEarned%>" value="<%=armyEarned%>">ARMY</p>
                                <p><input type="text" id="navyLeft" name="navyLeft" placeholder="<%=navyEarned%>" value="<%=navyEarned%>">NAVY</p>
                            </div>

                            
                        </div>
                    </div>
                </div>
                <div id="rightSide">
                    <h2 style="font-weight:700">Your Distribution</h2>

                    <% for (let i = 0; i < winningNation.currAllies.length; i++) { %>
                        <div>Give <%=winningNation.currAllies[i].name%> <input type="number" value="0" min="0" max="<%=armyEarned%>" onchange="getArmyPoints(this, <%=winningNation.currAllies[i].name%>, <%=winningNation.name%>)"> army points and <input type="number" value="0" min="0" max="<%=navyEarned%>" onchange="getNavyPoints(this, <%=winningNation.currAllies[i].name%>, <%=winningNation.name%>)"> navy points.</div>
                        <p></p>
                    <% } %>
                    
                    <div id="bar" style="width: 50%; height: 1px; background-color: lightgrey;"></div>

                    <% if (owePoints.length === 0) { %>
                    <% } else if (owePoints.length === 1) { %>
                        <p style="font-style: italic">Remember, you owe <span style="color: #b30000; font-style: initial"><%= owePoints[0] %></span> military points.</p>
                    <% } else if (owePoints.length > 1) { %>
                        <p style="font-style: italic">Remember, you owe 
                        <span style="color: #b30000; font-style: initial"><%= owePoints[0] %></span> 
                        <% for (let d = 1; d < owePoints.length; d++) { %>
                            and <span style="color: #b30000; font-style: initial"><%= owePoints[d] %></span>
                        <% } %> 
                        military points.
                        </p>
                    <% } %>
                </div>
                
            </div>
            <div id="statsBox">
                <div>
                    <h1 style="font-weight:700; padding: 0; margin-top: 0">Live Stats</h1>
                </div>
                
                <div style="display: flex; overflow-x: scroll">

                    <table id="statsTable" style="width: 500px; border-collapse: collapse; border-spacing: 0;">
                        <thead>
                            <tr style="text-align: left; background-color: #354860; color: lightgrey;">
                                <th>NATION</th>
                                <th>ARMY</th>
                                <th>NAVY</th>
                                <th>MORALE</th>
                                <th>TOTAL</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="<%=winningNation.name%>">
                                <td><%=winningNation.name%></td>
                                <td id="<%=winningNation.name%>Army">
                                    <input type="text" id="<%=winningNation.name%>Army" name="<%=winningNation.name%>Army" value="<%=winningNation.totalArmy + armyEarned%>" placeholder="<%=winningNation.totalArmy + armyEarned%>">
                                </td>
                                <td id="<%=winningNation.name%>Navy">
                                    <input type="text" id="<%=winningNation.name%>Navy" name="<%=winningNation.name%>Navy" value="<%=winningNation.totalNavy + navyEarned%>" placeholder="<%=winningNation.totalNavy + navyEarned%>">
                                </td>
                                <td id="<%=winningNation.name%>Moral">
                                    <input type="text" id="<%=winningNation.name%>Moral" name="<%=winningNation.name%>Moral" value="<%=winningNation.moral%>">
                                </td>
                                <td id="<%=winningNation.name%>Total">
                                    <input type="text" id="<%=winningNation.name%>Total" name="<%=winningNation.name%>Total" value="<%= winningNation.totalTotal + armyEarned + navyEarned %>" placeholder="<%= winningNation.totalTotal + armyEarned + navyEarned %>">
                                </td>
                            </tr>
                            <% for (let n = 0; n < winAllies.length; n++) { %>
                                <tr id="<%=winAllies[n].name%>">
                                    <td id="<%=winAllies[n].name%>Name"><input type="text" name="<%=winAllies[n].name%>Name" value="<%= winAllies[n].name%>"></td>
                                    <td id="<%=winAllies[n].name%>Army">
                                        <input type="text" id="<%=winAllies[n].name%>Army" name="<%=winAllies[n].name%>Army" value="<%= winAllies[n].army%>" placeholder="<%= winAllies[n].army%>">
                                    </td>
                                    <td id="<%=winAllies[n].name%>Navy">
                                        <input type="text" id="<%=winAllies[n].name%>Navy" name="<%=winAllies[n].name%>Navy" value="<%=winAllies[n].navy%>" placeholder="<%=winAllies[n].navy%>">
                                    </td>
                                    <td id="<%=winAllies[n].name%>Moral">
                                        <input type="text" id="<%=winAllies[n].name%>Moral" name="<%=winAllies[n].name%>Moral" value="<%=winAllies[n].moral%>">
                                    </td>
                                    <td id="<%=winAllies[n].name%>Total">
                                        <input type="text" id="<%=winAllies[n].name%>Total" name="<%=winAllies[n].name%>Total" value="<%= winAllies[n].total%>" placeholder="<%= winAllies[n].total%>">
                                    </td>
                                </tr>
                            <% } %>
                            <% for (let t = 0; t < loseAllies.length; t++) { %>
                                <tr id="<%= loseAllies[t].name%>">
                                    <td><input type="text" name="<%=loseAllies[t].name%>Name" value="<%= loseAllies[t].name%>"></td>
                                    <td><input type="text" name="<%=loseAllies[t].name%>Army" value="<%= loseAllies[t].army%>"></td>
                                    <td><input type="text" name="<%=loseAllies[t].name%>Navy" value="<%= loseAllies[t].navy%>"></td>
                                    <td><%= loseAllies[t].moral %></td>
                                    <td><input type="text" name="<%=loseAllies[t].name%>Total" value="<%= loseAllies[t].total%>"></td>
                                </tr>
                            <% } %>
                            <% for (let m = 0; m < allNations.length; m++) { %>
                                <tr id="<%= allNations[m].name%>">
                                    <td><%= allNations[m].name%></td>
                                    <td><%= allNations[m].army %></td>
                                    <td><%= allNations[m].navy %></td>
                                    <td><%= allNations[m].moral %></td>
                                    <td><%= allNations[m].total %></td>
                                </tr>
                            <% } %>
                            <tr id="<%=losingNation.name%>">
                                <td><input type="text" name="LOST" value="<%=losingNation.name%>"></td>
                                <td><%= losingNation.army %></td>
                                <td><%= losingNation.navy %></td>
                                <td><%= losingNation.moral %></td>
                                <td><%= losingNation.total %></td>
                            </tr>


                        </tbody>
                    </table>
                    <div style="flex: 1;">
                    <div style="height: 2px; width: 100%; background-color: #354860"></div>
                    <div style="height: 2px; width: 80%; background-color: #354860; margin-top: 9.5px"></div>
                    <div style="height: 2px; width: 60%; background-color: #354860; margin-top: 9.5px"></div>
                    <div style="height: 2px; width: 50%; background-color: #354860; margin-top: 9.5px"></div>
<!--
                    <div style="height: 2px; width: 45%; background-color: #adb3b3; margin-top: 10px"></div>
                    <div style="height: 2px; width: 40%; background-color: #adb3b3; margin-top: 10px"></div>
                    <div style="height: 2px; width: 37%; background-color: #adb3b3; margin-top: 10px"></div>
-->
                </div>
                    
                </div>
            </div>
            
            <div style="display: flex; flex-direction: row">
                <div style="background-color: #667579; padding-top: 30px; margin-right: -30px; margin-left: -30px; text-align: center; margin-top: 20px; flex: 2">
                    <h2 id="acceptRefugeesH2">Accept Refugees</h2>
                    <p style="font-size: 1.3rem"><%=losingNation.name%> has <%=losingNation.moral%> moral points and thousands of refugees. Who will take them?</p>
                    <p>Please select a country: 
                        <input type="hidden" name="moralValue" value="<%=losingNation.moral%>">
                        <select name="refugeeAccept" style="width: 120px; font-size: 1rem; font-family: Kumbh Sans">
                            <% for (let z = 0; z < allNationsNotLose.length; z++) { %>
                                <option value="<%=allNationsNotLose[z].name%>"><%=allNationsNotLose[z].name%></option>
                            <% } %>
                        </select>
                    </p>
                    
                    <div style="display: flex; justify-content: space-between; margin-left: 30px; margin-right: 30px">
                        <a style="text-decoration: none" class="button" href="javascript:history.go(-1)">&larr;</a>
                        <button class="button" type="submit">&rarr;</button>
                    </div>

                    
                </div>
                
                
                
            </div>
            
            
           
            
            
        </form>
    </div>
       
    <div id="footerDiv">
        <p>World War I Game © 2024 M. Felsmann</p>
    </div>
        
    
    
    <script>
        
    function getArmyPoints(x, y, z) {
        const trElement = y;
        const trWinElement = z;

        const armyTd = trElement.children.namedItem(trElement.id + "Army");
        const armyInput = armyTd.children.namedItem(trElement.id + "Army");
        
        const navyTd = trElement.children.namedItem(trElement.id + "Navy");
        const navyInput = navyTd.children.namedItem(trElement.id + "Navy");
        
        const moralTd = trElement.children.namedItem(trElement.id + "Moral");
        const moralInput = moralTd.children.namedItem(trElement.id + "Moral");
        
        const totalTd = trElement.children.namedItem(trElement.id + "Total");
        const totalInput = totalTd.children.namedItem(trElement.id + "Total");
        
        const winnerTdArmy = trWinElement.children.namedItem(trWinElement.id + "Army");
        const winnerInputArmy = winnerTdArmy.children.namedItem(trWinElement.id + "Army");
        
        const winnerTdNavy = trWinElement.children.namedItem(trWinElement.id + "Navy");
        const winnerInputNavy = winnerTdNavy.children.namedItem(trWinElement.id + "Navy");
        
        const winnerTdMoral = trWinElement.children.namedItem(trWinElement.id + "Moral");
        const winnerInputMoral = winnerTdMoral.children.namedItem(trWinElement.id + "Moral");
        
        const winnerTdTotal = trWinElement.children.namedItem(trWinElement.id + "Total");
        const winnerInputTotal = winnerTdTotal.children.namedItem(trWinElement.id + "Total");
        
        console.log(armyInput.value)
        console.log(navyInput.value)
        console.log(totalInput.value)
        
        console.log(z)
        
        armyInput.value = parseInt(armyInput.placeholder) + parseInt(x.value);
        totalInput.value = parseInt(armyInput.value) + parseInt(navyInput.value) + parseInt(moralInput.value);
        
        winnerInputArmy.value = parseInt(winnerInputArmy.placeholder) - parseInt(x.value);
        winnerInputTotal.value = parseInt(winnerInputArmy.value) + parseInt(winnerInputNavy.value) + parseInt(winnerInputMoral.value);
        
        const armyLeft = document.getElementById("armyLeft");
//        console.log(armyLeft.name)
//        console.log(parseInt(armyLeft.textContent));
//        console.log(parseInt(x.value));
        armyLeft.value = parseInt(armyLeft.placeholder) - parseInt(x.value);
        
    }
    
    function getNavyPoints(x, y, z) {
        const trElement = y;
        const trWinElement = z;

        const armyTd = trElement.children.namedItem(trElement.id + "Army");
        const armyInput = armyTd.children.namedItem(trElement.id + "Army");
        
        const navyTd = trElement.children.namedItem(trElement.id + "Navy");
        const navyInput = navyTd.children.namedItem(trElement.id + "Navy");
        
        const moralTd = trElement.children.namedItem(trElement.id + "Moral");
        const moralInput = moralTd.children.namedItem(trElement.id + "Moral");
        
        const totalTd = trElement.children.namedItem(trElement.id + "Total");
        const totalInput = totalTd.children.namedItem(trElement.id + "Total");
        
        const winnerTdArmy = trWinElement.children.namedItem(trWinElement.id + "Army");
        const winnerInputArmy = winnerTdArmy.children.namedItem(trWinElement.id + "Army");
        
        const winnerTdNavy = trWinElement.children.namedItem(trWinElement.id + "Navy");
        const winnerInputNavy = winnerTdNavy.children.namedItem(trWinElement.id + "Navy");
        
        const winnerTdMoral = trWinElement.children.namedItem(trWinElement.id + "Moral");
        const winnerInputMoral = winnerTdMoral.children.namedItem(trWinElement.id + "Moral");
        
        const winnerTdTotal = trWinElement.children.namedItem(trWinElement.id + "Total");
        const winnerInputTotal = winnerTdTotal.children.namedItem(trWinElement.id + "Total");
        
        console.log(armyInput.value)
        console.log(navyInput.value)
        console.log(totalInput.value)
        
        console.log(x.value)
        
        navyInput.value = parseInt(navyInput.placeholder) + parseInt(x.value);
        totalInput.value = parseInt(armyInput.value) + parseInt(navyInput.value) + parseInt(moralInput.value);
        
        winnerInputNavy.value = parseInt(winnerInputNavy.placeholder) - parseInt(x.value);
        winnerInputTotal.value = parseInt(winnerInputArmy.value) + parseInt(winnerInputNavy.value) + parseInt(winnerInputMoral.value);
        
        const navyLeft = document.getElementById("navyLeft");
        navyLeft.value = parseInt(navyLeft.placeholder) - parseInt(x.value);
    }
        
        async function homefunc() { //search box function
    window.location.href = '/'; 
}
        
       
</script>

</body>
</html>